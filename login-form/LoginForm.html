<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css">
</head>
<body>

    <div class="container p-2" id="app">
        <form>

            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text bg-white" v-bind:class="usernameIconColor" id="basic-addon2">
                        <i v-bind:class="usernameIconType"></i>
                    </span>
                </div>
                <input type="text" v-model="username" v-bind:class="{ 'border-danger': isUsernameHasError }" name="myusername" class="form-control" placeholder="Username" />
            </div>
            <sup v-if="isUsernameHasError" class="text-danger">{{ usernameErrorMessage }}</sup> 

            <div v-if="isUsernameChecked" class="input-group mb-3" >
                <div class="input-group-prepend">
                    <span class="input-group-text bg-white" v-bind:class="passwordIconColor" id="basic-addon2">
                        <i v-bind:class="passwordIconType"></i>
                    </span>
                </div>
                <input type="password" v-model="password" name="mypassword" v-bind:class="{ 'border-danger': isPasswordHasError }" class="form-control" placeholder="Password" />
            </div>
            <sup v-if="isPasswordHasError" class="text-danger text-center">{{ passwordErrorMessage }}</sup>
            
            <button type="button" v-bind:disabled="formValidating" v-on:click.prevent="validate" class="btn btn-primary w-100">{{ buttonValidateMessage }}</button>

        </form>

    </div>

    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="liveToast" class="toast bg-success" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header text-success">
                <i class="bi bi-check-circle"></i> &nbsp;
                <strong class="me-auto">Success</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body text-white">
            Vous êtes connecté avec succès...
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script>

        new Vue({
            el: '#app',
            data : {
                usernameErrorMessage: 'Aucun compte n\'est associé à ce nom d \'utilisateur',
                passwordErrorMessage: 'Mot de passe incorrect',
                isUsernameChecked: false,
                isPasswordChecked: false,
                isUsernameHasError: false,
                isPasswordHasError: false,
                isFormValidating: false,
                buttonValidateMessage : 'Continuer',
                formValidating: false,
                formValidate: false,
                username: '',
                password: ''
            },

            methods: {

                checkUsername: function () {

                    if (this.username !== '') {

                        if (this.username === 'azerty') {
                            this.isUsernameChecked = true;
                            this.isUsernameHasError = false;
                            this.buttonValidateMessage = 'Validate';
                        } else {
                            this.isUsernameChecked = false;
                            this.isUsernameHasError = true;
                        }

                    } else {
                        this.isUsernameChecked = false;
                        this.isUsernameHasError = false;
                    }

                },
                
                checkPassword: function () {

                    this.formValidating = true;
                    this.buttonValidateMessage = 'Loading...';

                    if (this.password === '123azerty') {
                            this.isPasswordChecked = true;
                            this.isPasswordHasError = false;
                    } else {
                        this.buttonValidateMessage = 'Validate';
                        this.formValidating = false;
                        this.isPasswordChecked = false;
                        this.isPasswordHasError = true;
                    }
                },
                
                validate: function () {

                    if (this.username !== '' && this.isUsernameChecked === false) {
                        this.checkUsername();
                    } else if (this.password !== '' && this.isUsernameChecked === true) {
                        this.checkPassword();
                    }

                    if ((this.isUsernameChecked && this.isPasswordChecked)) {
                        setTimeout(() => {
                            this.formValidate = true;
                            this.formValidating = false;
                            this.isUsernameChecked = false,
                            this.isPasswordChecked = false,
                            this.isUsernameHasError = false,
                            this.isPasswordHasError = false,
                            this.isFormValidating = false,
                            this.username = '';
                            this.password = '';
                            this.buttonValidateMessage = 'Validate';

                            let toastLiveExample = document.getElementById('liveToast');
                            new bootstrap.Toast(toastLiveExample).show();
                        }, 2000);
                    }
                    
                },
                
            },

            computed: {

                passwordIconType : function () {
                    return { 
                        'bi bi-lock-fill': !this.isPasswordChecked, 
                        'bi bi-unlock-fill': this.isPasswordChecked 
                    }
                },
                passwordIconColor: function () {
                    return { 
                        'text-success': this.isPasswordChecked, 
                        'text-danger': this.isPasswordHasError 
                    }
                },
                usernameIconType: function () {
                    return { 
                        'bi bi-person-circle': !this.isUsernameChecked, 
                        'bi bi-person-check-fill': this.isUsernameChecked, 
                        'bi-person-x-fill': this.isUsernameHasError 
                    }
                },
                usernameIconColor: function () {
                    return {
                        'text-success': this.isUsernameChecked, 
                        'text-danger': this.isUsernameHasError
                    }
                }

            },

            watch: {
                username : function (newValue, oldValue) {
                    if (newValue === '') {
                        this.isUsernameHasError = false;
                        this.isUsernameChecked = false;
                    }
                },
            },
        });
    </script>
</body>
</html>